{"version":3,"file":"glee.proto.js","sources":["../../helpers/general.js","../../template/proto/glee.proto.js"],"sourcesContent":["import _ from 'lodash';\nexport function camelCase(string) {\n    return _.camelCase(string);\n}\nexport function pascalCase(string) {\n    string = _.camelCase(string);\n    return string.charAt(0).toUpperCase() + string.slice(1);\n}\nexport function kebabCase(string) {\n    return _.kebabCase(string);\n}\n","\nimport { AsyncAPIDocument } from '@asyncapi/parser';\nimport { TypeScriptGenerator, FormatHelpers } from '@asyncapi/modelina';\nimport { File } from '@asyncapi/generator-react-sdk';\nimport {pascalCase, camelCase} from '../../helpers/general';\n\n\nfunction renderGRPCType(model) {\n  if (Array.isArray(model)) {\n    return model.map(t => this.renderGRPCType(t)).join(' | ');\n  }\n  if (model.enum !== undefined) {\n    return model.enum.map(value => typeof value === 'string' ? `\"${value}\"` : value).join(' | ');\n  }\n  if (model.$ref !== undefined) {\n    return pascalCase(model.$ref);\n  }\n  if (Array.isArray(model.type)) {\n    let index = 1;\n    return `oneof ${pascalCase(model.$id)} { ${model.type.map(t => `${this.toGRPCType(t, model)} ${camelCase(this.toGRPCType(t, model))}Value = ${index++};`)} }`;\n  }\n  return toGRPCType(model.type, model);\n}\n\nfunction toGRPCType(type, model) {\n  if (type === undefined) {\n    return 'google.protobuf.Any';\n  }\n  switch (type) { \n  case 'string':\n    return 'string';\n  case 'integer':\n    return 'int64';\n  case 'number':\n    return 'double';\n  case 'boolean':\n    return 'bool';\n  case 'array': {\n    return `repeated ${this.renderGRPCType(model.items)}`;\n  }\n  default: return type;\n  }\n}\n/**\n * Custom model preset to ensure property names are lower cased\n */\n const preset = {\n  interface: {\n    async self({ renderer, model }) {\n      const propertyEntries = Object.keys(model.properties).length ? Object.entries(model.properties) : [];\n      let index = 1;\n      let properties = propertyEntries.map(([propName, propModel]) => {\n        return `\n    ${renderGRPCType(propModel)} ${camelCase(propName)} = ${index++};\n        `;\n      });\n      return `\nmessage ${pascalCase(renderer.model.$id)} {\n  ${properties.join('\\n')}\n}      \n      `;\n    }\n  }\n};\n\nasync function gRPCMessages(asyncapi){\n  const typescriptGenerator = new TypeScriptGenerator({modelType: 'interface', presets: [preset]});\n  const generatedModels = await typescriptGenerator.generate(asyncapi);\n  const files = [];\n  for (const generatedModel of generatedModels) {\n    files.push(generatedModel.result);\n  }\n  return files;\n}\n\n/**\n * @typedef RenderArgument\n * @type {object}\n * @property {AsyncAPIDocument} asyncapi received from the generator.\n * @property {TemplateParameters} params received from the generator.\n */\n/**\n * Function to render file.\n * \n * @param {RenderArgument} param0 render arguments received from the generator.\n */\nexport default async function index({ asyncapi, params }) {\n  let serviceRPC = [];\n  const channelEntries = Object.keys(asyncapi.channels()).length ? Object.entries(asyncapi.channels()) : [];\n  serviceRPC = channelEntries.map(([channelName, channel]) => {\n    let rpcCallName;\n    let requestMessage;\n    let responseMessage;\n    if(channel.hasPublish()){\n      rpcCallName = `Say${pascalCase(channelName)}`;\n      requestMessage = pascalCase(channel.publish().bindings().grpc.subscribe.payload.$id);\n      responseMessage = pascalCase(channel.publish().message().payload().uid());\n    }\n    if(channel.hasSubscribe()){\n      rpcCallName = `Say${pascalCase(channelName)}`;\n      requestMessage = pascalCase(channel.subscribe().message().payload().uid());\n      responseMessage = pascalCase(channel.subscribe().bindings().grpc.publish.payload.$id);\n    }\n    return `\nrpc ${rpcCallName} (${requestMessage}) returns (${responseMessage}) {}\n    `;\n  });\n  return (\n    <File name=\"glee.proto\">\n      {`\nsyntax = \"proto3\";\n\noption java_multiple_files = true;\noption java_package = \"asyncapi.glee\";\noption java_outer_classname = \"HelloWorldProto\";\noption objc_class_prefix = \"HLW\";\n\npackage asyncapi.glee;\n\n// The greeting service definition.\nservice Glee {\n  ${serviceRPC.join('')}\n}\n\nimport \"google/protobuf/any.proto\";\n\n${(await gRPCMessages(asyncapi)).join('')}\n\n`}\n    </File>\n  );\n}\n"],"names":["camelCase","string","_","pascalCase","charAt","toUpperCase","slice","renderGRPCType","model","Array","isArray","map","t","join","enum","undefined","value","$ref","type","index","$id","toGRPCType","items","preset","interface","self","renderer","propertyEntries","Object","keys","properties","length","entries","propName","propModel","gRPCMessages","asyncapi","typescriptGenerator","TypeScriptGenerator","modelType","presets","generatedModels","generate","files","generatedModel","push","result","params","serviceRPC","channelEntries","channels","channelName","channel","rpcCallName","requestMessage","responseMessage","hasPublish","publish","bindings","grpc","subscribe","payload","message","uid","hasSubscribe","_jsx","File"],"mappings":"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"}